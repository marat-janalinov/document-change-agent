# üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ñ–∞–π–ª–∞–º –ø—Ä–æ–º–ø—Ç–æ–≤

## üìÇ –§–∞–π–ª—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è **4 —Ñ–∞–π–ª–∞ –ø—Ä–æ–º–ø—Ç–æ–≤** –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `backend/prompts/`:

### 1. `instruction_check_system.md`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** System prompt –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (–ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –≤ JSON)
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** `check_instructions()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- **–†–∞–∑–º–µ—Ä:** ~11KB (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –ü—Ä–∏ –≤—ã–∑–æ–≤–µ API `/api/check-instructions`

### 2. `instruction_check_user.md`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** User prompt –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** `check_instructions()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- **–†–∞–∑–º–µ—Ä:** ~7.5KB (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –ü—Ä–∏ –≤—ã–∑–æ–≤–µ API `/api/check-instructions`

### 3. `change_application_system.md`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** System prompt –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** `process_documents()` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É
- **–†–∞–∑–º–µ—Ä:** ~650 –±–∞–π—Ç
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –ü—Ä–∏ –≤—ã–∑–æ–≤–µ API `/api/process-documents`

### 4. `change_application_user.md`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** User prompt –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:** `process_documents()` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É
- **–†–∞–∑–º–µ—Ä:** ~460 –±–∞–π—Ç
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –ü—Ä–∏ –≤—ã–∑–æ–≤–µ API `/api/process-documents`

---

## üîÑ –ú–µ—Ö–∞–Ω–∏–∑–º –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤

### –ú–µ—Ç–æ–¥ `_load_prompt()` –≤ `parlant_agent.py`:

```python
def _load_prompt(self, filename: str) -> str:
    # 1. –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ /data/prompts/ (runtime –≤–µ—Ä—Å–∏—è)
    data_dir = os.getenv("DATA_DIR", "/data")
    prompts_dir = os.path.join(data_dir, "prompts")
    
    # 2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ backend/prompts/ (–≤–µ—Ä—Å–∏—è –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)
    if not os.path.exists(prompts_dir):
        current_dir = os.path.dirname(os.path.abspath(__file__))
        prompts_dir = os.path.join(current_dir, "prompts")
```

**–ü–æ—Ä—è–¥–æ–∫ –ø–æ–∏—Å–∫–∞:**
1. `/data/prompts/` (runtime –≤–µ—Ä—Å–∏–∏ - –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã)
2. `backend/prompts/` (–≤–µ—Ä—Å–∏–∏ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è - fallback)

### –°–∫—Ä–∏–ø—Ç `init_prompts.py`:

**–ó–∞–¥–∞—á–∞:** –ö–æ–ø–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –∏–∑ `backend/prompts/` –≤ `/data/prompts/` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

**–í–∞–∂–Ω–æ:**
- –ö–æ–ø–∏—Ä—É–µ—Ç **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–∞–π–ª—ã –µ—â–µ –ù–ï —Å—É—â–µ—Å—Ç–≤—É—é—Ç** –≤ `/data/prompts/`
- –ï—Å–ª–∏ —Ñ–∞–π–ª—ã —É–∂–µ –µ—Å—Ç—å - **–ù–ï –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç** –∏—Ö
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ backend (—Å–º. `app.py` startup event)

---

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ –∫–æ–¥–µ

### –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:

```python
# –í –º–µ—Ç–æ–¥–µ check_instructions() –∏ _parse_instructions_simple()
system_prompt = self._load_prompt("instruction_check_system.md")
user_prompt = self._load_prompt("instruction_check_user.md")
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- `parlant_agent.check_instructions()` - —Å—Ç—Ä–æ–∫–∏ 3154, 3162
- `parlant_agent._parse_instructions_simple()` - —Å—Ç—Ä–æ–∫–∏ 2708, 2709

### –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```python
# –í –º–µ—Ç–æ–¥–µ process_documents() —á–µ—Ä–µ–∑ Parlant guidelines
# –ü—Ä–æ–º–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Parlant framework
system_prompt = self._load_prompt("change_application_system.md")
user_prompt = self._load_prompt("change_application_user.md")
```

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –í–µ—Ä—Å–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞:

–ü—Ä–æ–º–ø—Ç—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –º–µ–∂–¥—É:
- **–†–µ–æ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º** (`backend/prompts/`) - –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
- **Runtime** (`/data/prompts/`) - –º–æ–≥—É—Ç –±—ã—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏

### –ü—Ä–∏—á–∏–Ω–∞:

–°–∫—Ä–∏–ø—Ç `init_prompts.py` –∫–æ–ø–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ**. –ï—Å–ª–∏ —Ñ–∞–π–ª—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ `/data/prompts/`, –æ–Ω–∏ **–Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**!

### –†–µ—à–µ–Ω–∏–µ:

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω—É–∂–Ω–æ **–≤—Ä—É—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å** –∏—Ö:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
cp backend/prompts/*.md /data/prompts/

# –í–∞—Ä–∏–∞–Ω—Ç 2: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
rm /data/prompts/*.md
docker compose restart backend
# –ü—Ä–æ–º–ø—Ç—ã —Å–∫–æ–ø–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –ø—Ä–æ–º–ø—Ç–æ–≤

### –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
ls -lh backend/prompts/*.md
md5sum backend/prompts/*.md

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –≤ runtime
ls -lh data/prompts/*.md
md5sum data/prompts/*.md

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
diff -u data/prompts/instruction_check_system.md backend/prompts/instruction_check_system.md
```

### –ù–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ backend
docker compose exec backend bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –≤ runtime
ls -lh /data/prompts/*.md
md5sum /data/prompts/*.md

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
ls -lh /app/prompts/*.md
md5sum /app/prompts/*.md

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤
ls -lh /data/prompts/ /app/prompts/
```

---

## üîç –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∞—è –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–º–ø—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –ø—É—Ç—å (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω DEBUG):

```python
logger.debug(f"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ {filename} –∏–∑ {prompt_path}")
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤:

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `instruction_check_system.md`:
  - –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: ~11KB (170 —Å—Ç—Ä–æ–∫)
  - –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è: ~3KB (33 —Å—Ç—Ä–æ–∫–∏)
  
- `instruction_check_user.md`:
  - –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: ~7.5KB (164 —Å—Ç—Ä–æ–∫–∏)
  - –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è: ~10KB (108 —Å—Ç—Ä–æ–∫) - **–æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —Ä–∞–∑–º–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ!**

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç—ã** –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–µ—Ä—Å–∏–∏** –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MD5 —Ö–µ—à–∏** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π
4. **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞–ø—Ä—è–º—É—é** –≤ `/data/prompts/` - –∏–∑–º–µ–Ω—è–π—Ç–µ –≤ `backend/prompts/` –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

### `instruction_check_system.md`:
- –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- –ü—Ä–∞–≤–∏–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- –ü—Ä–∞–≤–∏–ª–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è `target.text`
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

### `instruction_check_user.md`:
- –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–±–∏–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- –ü—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ä–º–∞—Ç–æ–≤ JSON
- –ü—Ä–∞–≤–∏–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

### `change_application_system.md`:
- –†–æ–ª—å —ç–∫—Å–ø–µ—Ä—Ç–∞ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### `change_application_user.md`:
- –®–∞–±–ª–æ–Ω –¥–ª—è —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

---

**–í–∞–∂–Ω–æ:** –í—Å–µ –ø—Ä–æ–º–ø—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (`backend/prompts/`) - —ç—Ç–æ **–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**. –í–µ—Ä—Å–∏–∏ –≤ `/data/prompts/` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –Ω–∏–º–∏.
