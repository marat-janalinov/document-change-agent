# User Prompt для проверки инструкций

Проанализируй содержимое документа и найди ВСЕ инструкции по изменению текста. 

## АЛГОРИТМ АНАЛИЗА (КРИТИЧЕСКИ ВАЖНО):
1. Прочитай весь документ от начала до конца для общего понимания
2. Подсчитай количество инструкций (если указано в документе или если видишь нумерацию типа "1.", "2.", "3." и т.д.)
3. Прочитай документ ВТОРОЙ РАЗ, внимательно анализируя каждую строку, каждый абзац, каждую таблицу, каждый список
4. Для каждой найденной инструкции создай отдельный объект в массиве changes
5. Проверь, что ты не пропустил ни одной инструкции - перечитай документ ТРЕТИЙ РАЗ, если нужно
6. Если в документе указано конкретное количество инструкций (например, "6 изменений") или видишь нумерацию до 6, убедись, что количество найденных инструкций ТОЧНО совпадает
7. Если ты нашел меньше инструкций, чем ожидается, ПЕРЕЧИТАЙ документ еще раз и найди пропущенные
8. КРИТИЧЕСКИ ВАЖНО: Каждая инструкция, даже если она выражена кратко или неявно, ДОЛЖНА быть включена в результат

Инструкции могут быть представлены в любом формате: списки, параграфы, таблицы, свободный текст, нумерованные списки, маркированные списки, смешанный формат. 

## ОСОБЫЙ СЛУЧАЙ - ИНСТРУКЦИЯ С ТАБЛИЦЕЙ:
Если встречается инструкция типа "пункт X изложить в следующей редакции" или "пункт X изложить в редакции", 
а ниже этой инструкции находится таблица, то:
1. Таблица должна быть ВСТАВЛЕНА как таблица, а не преобразована в текст
2. Используй операцию INSERT_TABLE с:
   - target.after_text = текст пункта, после которого вставить таблицу (например, "X.")
   - payload.rows = массив строк таблицы, каждая строка - массив ячеек
   - payload.columns = количество колонок (опционально, можно определить из данных)
3. Извлеки все данные из таблицы: каждая строка таблицы = один элемент массива rows
4. Каждая ячейка таблицы = один элемент массива ячеек в строке

Преобразуй найденные инструкции в валидный JSON формат.

## ФОРМАТ ОТВЕТА:
```json
{
  "changes": [
    {
      "change_id": "CHG-001",
      "description": "Краткое описание действия",
      "operation": "REPLACE_TEXT",
      "target": { "text": "текст для поиска", "match_case": false },
      "payload": { "new_text": "новый текст" },
      "annotation": true
    }
  ]
}
```

## ТИПЫ ИНСТРУКЦИЙ (примеры, но не ограничивайся ими):

### 1. ЗАМЕНА ТЕКСТА:
- Массовая замена: "заменить X на Y", "X → Y", "X заменяется на Y"
- Замена в конкретном месте: "в пункте X заменить Y на Z", "в разделе X изменить Y"
- Для массовых замен используй match_case=false, replace_all=true

### 2. УДАЛЕНИЕ:
- Удаление пункта/раздела: "исключить пункт X", "удалить раздел Y", "пункт X исключить"
- Удаление текста: "исключить слова X", "удалить фразу Y"

### 3. ИЗМЕНЕНИЕ:
- Изменение пункта: "пункт X изложить в редакции", "пункт X изменить на", "пункт X в новой редакции"
- Изменение подпункта: "подпункт Y пункта X изложить", "пункт Y раздела X изменить"
- ВАЖНО: Если инструкция содержит "изложить в следующей редакции" или "изложить в редакции", 
а ниже есть таблица, то таблица содержит новый текст пункта. 
Извлеки весь текст из таблицы и используй его как payload.new_text для REPLACE_POINT_TEXT

### 4. ДОБАВЛЕНИЕ:
- Вставка текста: "добавить после пункта X", "вставить в раздел Y", "дополнить пунктом Z"
- Добавление раздела: "добавить раздел X", "вставить главу Y"

### 5. КОММЕНТАРИИ:
- Добавление комментария: "добавить комментарий к пункту X", "прокомментировать раздел Y"
- ВАЖНО: Для ADD_COMMENT обязательно указывай:
  - payload.paragraph_hint: текст параграфа для поиска (например, начало пункта "36.")
  - payload.comment_text: текст комментария
- Пример: {"operation": "ADD_COMMENT", "target": {"text": "36."}, "payload": {"paragraph_hint": "36.", "comment_text": "Комментарий к пункту"}}

## ПРАВИЛА РАСПОЗНАВАНИЯ:
- Анализируй СМЫСЛ инструкции, а не только точные формулировки
- Ищи ключевые слова: заменить, исключить, изложить, добавить, удалить, изменить, в новой редакции, в редакции, в следующей редакции
- Определяй номера пунктов, разделов, подпунктов из контекста
- Для пунктов используй формат "X." или "X)" для поиска (например, "30.", "36)")
- Для массовых замен используй базовую форму слова
- target.text должен быть достаточно уникальным для поиска в документе
- ВАЖНО: Инструкции могут быть разделены на несколько абзацев или строк - читай внимательно
- ВАЖНО: Инструкции могут быть в разных частях документа - проверь ВСЕ разделы
- ВАЖНО: Если инструкция продолжается на следующей строке или абзаце, объедини их в одну операцию
- ВАЖНО: Не пропускай инструкции, которые выражены косвенно или требуют интерпретации

## СТРУКТУРА ОПЕРАЦИЙ:
- REPLACE_TEXT: target.text (текст для поиска), payload.new_text (новый текст), target.match_case, target.replace_all
- REPLACE_POINT_TEXT: target.text (начало пункта, например "36."), payload.new_text (весь новый текст пункта)
- DELETE_PARAGRAPH: target.text (текст пункта/раздела для удаления)
- INSERT_PARAGRAPH: target.after_text (текст после которого вставить), payload.text (текст для вставки)
- INSERT_SECTION: target.after_heading, payload.heading_text, heading_level, paragraphs[]
- INSERT_TABLE: target.after_text (текст после которого вставить таблицу), payload.rows (массив строк, каждая строка - массив ячеек), payload.columns (количество колонок)
- ADD_COMMENT: target.text (текст параграфа, к которому добавить комментарий), payload.paragraph_hint (текст для поиска параграфа), payload.comment_text (текст комментария)

## ПРАВИЛА ДЛЯ ТАБЛИЦ:
- Если таблица следует после инструкции "изложить в следующей редакции" или "изложить в редакции", 
используй операцию INSERT_TABLE для вставки таблицы как таблицы
- Извлекай данные из таблицы построчно: каждая строка таблицы = один элемент массива rows
- Каждая ячейка в строке = один элемент массива ячеек
- Пример структуры: {"rows": [["Ячейка 1-1", "Ячейка 1-2"], ["Ячейка 2-1", "Ячейка 2-2"]], "columns": 2}
- Не пропускай пустые ячейки - используй пустые строки "" для пустых ячеек

## ТРЕБОВАНИЯ К JSON:
- Ответ ДОЛЖЕН быть валидным JSON (проверь синтаксис перед отправкой)
- НЕ используй trailing commas (запятые перед }, ])
- Экранируй специальные символы: \", \n, \t
- Все строки в двойных кавычках
- Сохраняй порядок инструкций из документа
- Для каждой инструкции создавай отдельную операцию
- Используй понятные description на русском языке
- КРИТИЧЕСКИ ВАЖНО: Включи ВСЕ найденные инструкции в массив changes - не пропускай ни одной
- КРИТИЧЕСКИ ВАЖНО: Если в документе есть нумерация инструкций (1, 2, 3, 4, 5, 6), убедись, что ты нашел ВСЕ пронумерованные инструкции
- КРИТИЧЕСКИ ВАЖНО: Если ты нашел меньше инструкций, чем видишь в документе, ПЕРЕЧИТАЙ документ и найди пропущенные - это ОБЯЗАТЕЛЬНО
- КРИТИЧЕСКИ ВАЖНО: Не останавливайся, пока не найдешь ВСЕ инструкции из документа

