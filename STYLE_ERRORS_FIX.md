# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å—Ç–∏–ª–µ–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö

**–î–∞—Ç–∞:** 2025-11-24  
**–ü—Ä–æ–±–ª–µ–º–∞:** `KeyError: "no style with name 'Normal'"`, `"no style with name 'Comment'"`, `"no style with name 'Heading 2'"`

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏, –∫–æ–≥–¥–∞ –∫–æ–¥ –ø—ã—Ç–∞–ª—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∏–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ:
- `"no style with name 'Normal'"`
- `"no style with name 'Comment'"`
- `"no style with name 'Heading 2'"`

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –º–µ—Å—Ç–∞—Ö:
1. `mcp_client.py` - —Ñ—É–Ω–∫—Ü–∏—è `add_comment()` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
2. `parlant_agent.py` - —Ñ—É–Ω–∫—Ü–∏—è `_insert_paragraph_after()` –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏
3. `mcp_client.py` - —Ñ—É–Ω–∫—Ü–∏—è `_insert_paragraph_locally()` –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `add_comment()` –≤ `backend/mcp_client.py`

**–ë—ã–ª–æ:**
```python
try:
    new_paragraph.style = document.styles["Comment"]
except KeyError:
    new_paragraph.style = document.styles["Normal"]
```

**–°—Ç–∞–ª–æ:**
```python
# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∏–ª—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–ª–∏—á–∏—è
style_set = False
for style_name in ["Comment", "Normal", "Default Paragraph Font"]:
    try:
        if style_name in document.styles:
            new_paragraph.style = document.styles[style_name]
            style_set = True
            break
    except (KeyError, ValueError):
        continue

# –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω —Å—Ç–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–∑ —Å—Ç–∏–ª—è
if not style_set:
    logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∏–ª—å –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é")
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_insert_paragraph_locally()` –≤ `backend/mcp_client.py`

**–ë—ã–ª–æ:**
```python
try:
    paragraph.style = document.styles[style]
except KeyError:
    paragraph.style = document.styles["Normal"]
```

**–°—Ç–∞–ª–æ:**
```python
# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∏–ª—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–ª–∏—á–∏—è
style_set = False
# –ü—Ä–æ–±—É–µ–º —Å–Ω–∞—á–∞–ª–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å
try:
    if style in document.styles:
        paragraph.style = document.styles[style]
        style_set = True
except (KeyError, ValueError):
    pass

# –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏
if not style_set:
    for fallback_style in ["Normal", "Default Paragraph Font"]:
        try:
            if fallback_style in document.styles:
                paragraph.style = document.styles[fallback_style]
                style_set = True
                logger.debug(f"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å '{fallback_style}' –≤–º–µ—Å—Ç–æ '{style}'")
                break
        except (KeyError, ValueError):
            continue
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_insert_paragraph_after()` –≤ `backend/parlant_agent.py`

**–ë—ã–ª–æ:**
```python
if style:
    new_para.style = style
```

**–°—Ç–∞–ª–æ:**
```python
if style:
    # –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∏–ª—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–ª–∏—á–∏—è
    try:
        doc = paragraph._parent
        if hasattr(doc, 'styles'):
            # –ü—Ä–æ–±—É–µ–º —Å–Ω–∞—á–∞–ª–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å
            if style in doc.styles:
                new_para.style = style
            else:
                # –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏
                fallback_styles = []
                if "Heading" in style:
                    # –î–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
                    for level in range(1, 10):
                        fallback_styles.append(f"Heading {level}")
                fallback_styles.extend(["Normal", "Default Paragraph Font"])
                
                style_set = False
                for fallback_style in fallback_styles:
                    try:
                        if fallback_style in doc.styles:
                            new_para.style = fallback_style
                            style_set = True
                            logger.debug(f"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å '{fallback_style}' –≤–º–µ—Å—Ç–æ '{style}'")
                            break
                    except (KeyError, ValueError, AttributeError):
                        continue
                
                if not style_set:
                    logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∏–ª—å '{style}' –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –ø–∞—Ä–∞–≥—Ä–∞—Ñ –±—É–¥–µ—Ç –±–µ–∑ —Å—Ç–∏–ª—è")
    except Exception as e:
        logger.warning(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å—Ç–∏–ª—è '{style}': {e}, –ø–∞—Ä–∞–≥—Ä–∞—Ñ –±—É–¥–µ—Ç –±–µ–∑ —Å—Ç–∏–ª—è")
```

---

## üîç –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ Word –¥–æ–∫—É–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏, —Ç–∞–∫–∏–µ –∫–∞–∫:
- `Normal` - –±–∞–∑–æ–≤—ã–π —Å—Ç–∏–ª—å –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞
- `Comment` - —Å—Ç–∏–ª—å –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- `Heading 1`, `Heading 2`, –∏ —Ç.–¥. - —Å—Ç–∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

–≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å, –µ—Å–ª–∏:
1. –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ –¥—Ä—É–≥–æ–π –≤–µ—Ä—Å–∏–∏ Word
2. –î–æ–∫—É–º–µ–Ω—Ç –±—ã–ª –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ –¥—Ä—É–≥–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
3. –°—Ç–∏–ª–∏ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
4. –î–æ–∫—É–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ **–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∏–ª–µ–π** —Å:
1. **–ü—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–ª–∏—á–∏—è —Å—Ç–∏–ª—è** –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
2. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–º** - –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏
3. **Graceful degradation** - –µ—Å–ª–∏ —Å—Ç–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–∞—Ä–∞–≥—Ä–∞—Ñ —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–µ–∑ —Å—Ç–∏–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç–∏–ª—è:

1. –ü—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å
2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ:
   - –î–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤: `Heading 1`, `Heading 2`, ..., `Heading 9`
   - –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤: `Normal`, `Default Paragraph Font`
3. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–∑ —Å—Ç–∏–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞)

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend:**
   ```bash
   docker compose restart backend
   ```

2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker compose logs -f backend | grep -E "—Å—Ç–∏–ª—å|style|KeyError"
   ```

4. **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
   - –û–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ
   - –í –ª–æ–≥–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∏–ª–µ–π
   - –ü–∞—Ä–∞–≥—Ä–∞—Ñ—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

---

## üìù –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–ª–∏—è—é—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- ‚úÖ `REPLACE_TEXT` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
- ‚úÖ `DELETE_PARAGRAPH` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
- ‚úÖ `INSERT_PARAGRAPH` - –≤—Å—Ç–∞–≤–∫–∞ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
- ‚úÖ `INSERT_SECTION` - –≤—Å—Ç–∞–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
- ‚úÖ `ADD_COMMENT` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–∞—Ä–∞–≥—Ä–∞—Ñ—ã –±–µ–∑ —Å—Ç–∏–ª—è** - –ï—Å–ª–∏ —Å—Ç–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–∞—Ä–∞–≥—Ä–∞—Ñ —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å—Ç–∏–ª—è, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∏–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞.

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∏–ª–µ–π.

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª–µ–π –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É, –Ω–æ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∏–ª–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –û–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –Ω–µ –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–æ–π, –µ—Å–ª–∏ —Å—Ç–∏–ª—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.**

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-11-24

