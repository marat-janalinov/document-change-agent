# ü§ñ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LLM (OpenAI)

## üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env` —Ñ–∞–π–ª)

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
OPENAI_API_KEY=sk-your-openai-api-key-here

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
OPENAI_MODEL=gpt-4o                    # –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: gpt-4o
OPENAI_VERIFY_SSL=false                # –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: false)
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏

**–ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `gpt-4o`

–ï—Å–ª–∏ `OPENAI_MODEL` –Ω–µ —É–∫–∞–∑–∞–Ω –≤ `.env`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å `gpt-4o`.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞

**Timeout:** 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø—Ä–æ–≤–µ—Ä–∫–∞ SSL –æ—Ç–∫–ª—é—á–µ–Ω–∞ (`OPENAI_VERIFY_SSL=false`)
- –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞: –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏–∑ `certifi`

---

## üîß –ö–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ `parlant_agent.py`:

```python
# –ß—Ç–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
self.model_name: str = os.environ.get("OPENAI_MODEL", "gpt-4o")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è HTTP –∫–ª–∏–µ–Ω—Ç–∞
self._openai_http_client = httpx.AsyncClient(
    timeout=300.0,  # 5 –º–∏–Ω—É—Ç
    verify=verify_param,  # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏–ª–∏ False
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenAI –∫–ª–∏–µ–Ω—Ç–∞
self.openai_client = AsyncOpenAI(
    api_key=openai_key,
    http_client=self._openai_http_client,
)
```

---

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–∑–æ–≤–∞ API

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (`check_instructions`):

```python
response = await self.openai_client.chat.completions.create(
    model=self.model_name,           # –ò–∑ OPENAI_MODEL –∏–ª–∏ "gpt-4o"
    messages=[
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": full_prompt},
    ],
    temperature=0,                    # –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    max_tokens=16384,                 # –ú–∞–∫—Å–∏–º—É–º –¥–ª—è gpt-4o
    response_format={"type": "json_object"},  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π JSON
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `model`: `gpt-4o` (–∏–ª–∏ –∏–∑ `OPENAI_MODEL`)
- `temperature`: `0` (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã)
- `max_tokens`: `16384` (–º–∞–∫—Å–∏–º—É–º –¥–ª—è gpt-4o)
- `response_format`: `{"type": "json_object"}` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π JSON —Ñ–æ—Ä–º–∞—Ç)

### 2. –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (`_parse_instructions_simple`):

```python
response = await self.openai_client.chat.completions.create(
    model="gpt-4o",                   # –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å
    messages=[
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_message}
    ],
    temperature=0.1,                  # –ù–µ–º–Ω–æ–≥–æ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
    max_tokens=4000                   # –ú–µ–Ω—å—à–∏–π –ª–∏–º–∏—Ç
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `model`: `"gpt-4o"` (–∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–∞)
- `temperature`: `0.1` (–Ω–µ–±–æ–ª—å—à–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)
- `max_tokens`: `4000`

### 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã (`_intelligent_table_replacement`):

```python
response = await self.openai_client.chat.completions.create(
    model=self.model_name,            # –ò–∑ OPENAI_MODEL
    messages=[...],
    temperature=0,                    # –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    max_tokens=2000                   # –£–º–µ—Ä–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç
)
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ (`_check_text_distribution`):

```python
response = await self.openai_client.chat.completions.create(
    model=self.model_name,            # –ò–∑ OPENAI_MODEL
    messages=[...],
    temperature=0,                    # –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    max_tokens=1000                   # –ù–µ–±–æ–ª—å—à–æ–π –ª–∏–º–∏—Ç
)
```

### 5. –ü–æ–∏—Å–∫ –ø—É–Ω–∫—Ç–∞ (`_find_paragraph_number`):

```python
response = await self.openai_client.chat.completions.create(
    model=self.model_name,            # –ò–∑ OPENAI_MODEL
    messages=[...],
    temperature=0,                    # –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    max_tokens=500                    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç
)
```

---

## üìù –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------------------|----------|
| `OPENAI_MODEL` | `gpt-4o` | –ú–æ–¥–µ–ª—å OpenAI –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| `OPENAI_API_KEY` | (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) | API –∫–ª—é—á OpenAI |
| `OPENAI_VERIFY_SSL` | `false` | –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ |
| `timeout` | `300.0` —Å–µ–∫—É–Ω–¥ | –¢–∞–π–º–∞—É—Ç –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `temperature` | `0` –∏–ª–∏ `0.1` | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (0 = –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã) |
| `max_tokens` | `16384` / `4000` / `2000` / `1000` / `500` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏) |
| `response_format` | `{"type": "json_object"}` | –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π) |

---

## üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª: `backend/parlant_agent.py`

**–°—Ç—Ä–æ–∫–∏ 152-200:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

**–°—Ç—Ä–æ–∫–∞ 156:**
```python
self.model_name: str = os.environ.get("OPENAI_MODEL", "gpt-4o")
```

**–°—Ç—Ä–æ–∫–∏ 162-200:** –ú–µ—Ç–æ–¥ `initialize()` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ OpenAI

**–°—Ç—Ä–æ–∫–∏ 3193-3210:** –í—ã–∑–æ–≤ API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

**–°—Ç—Ä–æ–∫–∏ 2716-2730:** –í—ã–∑–æ–≤ API –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

---

## ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `.env`

```bash
# OpenAI API Configuration
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
OPENAI_MODEL=gpt-4o
OPENAI_VERIFY_SSL=false

# –î—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã...
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ OpenAI:** `openai==1.51.2` (–∏–∑ `backend/requirements.txt`)

**HTTP –∫–ª–∏–µ–Ω—Ç:** `httpx==0.28.1` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:** `certifi>=2024.2.2` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ SSL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìå –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ú–æ–¥–µ–ª—å `gpt-4o`:**
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ 16384 —Ç–æ–∫–µ–Ω–æ–≤ –≤ completion
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JSON —Ä–µ–∂–∏–º (`response_format`)
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

2. **Temperature:**
   - `0` - –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (–ø–∞—Ä—Å–∏–Ω–≥ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π)
   - `0.1` - –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–Ω–µ–±–æ–ª—å—à–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)

3. **Max tokens:**
   - `16384` - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (–±–æ–ª—å—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)
   - `4000` - –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
   - –ú–µ–Ω—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è - –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

4. **SSL:**
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ SSL
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–∞ —á–µ—Ä–µ–∑ `OPENAI_VERIFY_SSL=true`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏–∑ `certifi` –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏

---

## üö® –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **OPENAI_API_KEY** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–∫–∞–∑–∞–Ω –≤ `.env` —Ñ–∞–π–ª–µ
- –ú–æ–¥–µ–ª—å `gpt-4o` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ OpenAI
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ª–∏—á–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ OpenAI API

